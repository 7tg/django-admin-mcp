openapi: 3.0.3
info:
  title: Django Admin MCP API
  description: |
    Django Admin MCP provides programmatic access to Django admin models through the Model Context Protocol (MCP).
    
    This HTTP API allows you to:
    - Discover available Django models
    - Perform CRUD operations on exposed models
    - Search and filter data
    
    ## Authentication
    
    All requests require a Bearer token in the Authorization header:
    ```
    Authorization: Bearer YOUR_TOKEN_HERE
    ```
    
    Tokens can be created in the Django admin at `/admin/django_admin_mcp/mcptoken/`.
    
    ## Tool Exposure
    
    Only models with `mcp_expose = True` in their ModelAdmin class expose CRUD tools.
    Use the `find_models` tool to discover available models.
    
    ## Features
    
    - Token-based authentication with expiration support
    - Automatic CRUD tool generation for exposed models
    - Type-safe schema validation
    - Pagination support for list operations
    - Field-level permissions through Django admin
    
  version: 0.1.0
  contact:
    name: Django Admin MCP
    url: https://github.com/7tg/django-admin-mcp
  license:
    name: MIT
    url: https://github.com/7tg/django-admin-mcp/blob/main/LICENSE

servers:
  - url: /api
    description: API base path (relative to your Django server)

tags:
  - name: MCP
    description: Model Context Protocol operations
  - name: Health
    description: Service health checks

paths:
  /mcp/:
    post:
      tags:
        - MCP
      summary: MCP Protocol Endpoint
      description: |
        Main endpoint for MCP protocol operations. Supports two methods:
        - `tools/list`: List all available MCP tools
        - `tools/call`: Execute a specific MCP tool
      operationId: mcp_endpoint
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/ToolsListRequest'
                - $ref: '#/components/schemas/ToolsCallRequest'
            examples:
              listTools:
                summary: List available tools
                value:
                  method: "tools/list"
              findModels:
                summary: Discover available models
                value:
                  method: "tools/call"
                  name: "find_models"
                  arguments: {}
              findModelsWithQuery:
                summary: Search for specific models
                value:
                  method: "tools/call"
                  name: "find_models"
                  arguments:
                    query: "article"
              listModel:
                summary: List model instances
                value:
                  method: "tools/call"
                  name: "list_article"
                  arguments:
                    limit: 10
                    offset: 0
              getModel:
                summary: Get a specific instance
                value:
                  method: "tools/call"
                  name: "get_article"
                  arguments:
                    id: 1
              createModel:
                summary: Create a new instance
                value:
                  method: "tools/call"
                  name: "create_article"
                  arguments:
                    data:
                      title: "My New Article"
                      content: "Article content"
                      author_id: 1
              updateModel:
                summary: Update an instance
                value:
                  method: "tools/call"
                  name: "update_article"
                  arguments:
                    id: 1
                    data:
                      title: "Updated Title"
              deleteModel:
                summary: Delete an instance
                value:
                  method: "tools/call"
                  name: "delete_article"
                  arguments:
                    id: 1
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ToolsListResponse'
                  - $ref: '#/components/schemas/ToolCallResponse'
              examples:
                toolsList:
                  summary: Tools list response
                  value:
                    tools:
                      - name: "find_models"
                        description: "Discover available Django models"
                        inputSchema:
                          type: "object"
                          properties:
                            query:
                              type: "string"
                              description: "Optional search query"
                      - name: "list_article"
                        description: "List all Article instances"
                        inputSchema:
                          type: "object"
                          properties:
                            limit:
                              type: "integer"
                            offset:
                              type: "integer"
                findModelsResult:
                  summary: Find models result
                  value:
                    models:
                      - name: "article"
                        verbose_name: "Article"
                        tools_exposed: true
                      - name: "author"
                        verbose_name: "Author"
                        tools_exposed: true
                listResult:
                  summary: List instances result
                  value:
                    results:
                      - id: 1
                        title: "First Article"
                        author_id: 1
                      - id: 2
                        title: "Second Article"
                        author_id: 2
                    count: 2
                    total: 50
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidJSON:
                  value:
                    error: "Invalid JSON in request body"
                unknownMethod:
                  value:
                    error: "Unknown method: invalid_method"
                missingToolName:
                  value:
                    error: "Missing tool name"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid or missing authentication token"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "No result from tool"

  /health/:
    get:
      tags:
        - Health
      summary: Health Check
      description: Check if the service is running
      operationId: health_check
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  service:
                    type: string
                    example: "django-admin-mcp"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        Token-based authentication. Create tokens in Django admin at `/admin/django_admin_mcp/mcptoken/`.
        
        **Token Management:**
        - Tokens expire after 90 days by default (can be set to indefinite)
        - Tokens can be enabled/disabled via `is_active` field
        - Token usage is tracked with `last_used_at` timestamp

  schemas:
    ToolsListRequest:
      type: object
      required:
        - method
      properties:
        method:
          type: string
          enum:
            - "tools/list"
          description: Request to list all available MCP tools

    ToolsCallRequest:
      type: object
      required:
        - method
        - name
      properties:
        method:
          type: string
          enum:
            - "tools/call"
          description: Request to call a specific MCP tool
        name:
          type: string
          description: Name of the tool to call
          example: "find_models"
        arguments:
          type: object
          description: Tool-specific arguments
          additionalProperties: true

    ToolsListResponse:
      type: object
      properties:
        tools:
          type: array
          items:
            $ref: '#/components/schemas/Tool'

    Tool:
      type: object
      properties:
        name:
          type: string
          description: Tool name
          example: "list_article"
        description:
          type: string
          description: Tool description
          example: "List all Article instances with pagination"
        inputSchema:
          type: object
          description: JSON Schema for tool input parameters
          additionalProperties: true

    ToolCallResponse:
      type: object
      description: Response varies based on the tool called
      additionalProperties: true

    FindModelsResponse:
      type: object
      properties:
        models:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Model name (lowercase)
                example: "article"
              verbose_name:
                type: string
                description: Human-readable model name
                example: "Article"
              tools_exposed:
                type: boolean
                description: Whether CRUD tools are exposed for this model
                example: true

    ListResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            description: Model instance data
            additionalProperties: true
        count:
          type: integer
          description: Number of results in this page
          example: 10
        total:
          type: integer
          description: Total number of records
          example: 100

    GetResponse:
      type: object
      description: Single model instance data
      additionalProperties: true

    CreateResponse:
      type: object
      properties:
        id:
          type: integer
          description: ID of the created instance
          example: 42
        message:
          type: string
          example: "Article created successfully"

    UpdateResponse:
      type: object
      properties:
        message:
          type: string
          example: "Article updated successfully"

    DeleteResponse:
      type: object
      properties:
        message:
          type: string
          example: "Article deleted successfully"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid or missing authentication token"
